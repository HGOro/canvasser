{{!-- this is the user form --}}

<div class = "container">
    <form id="userForm">
        <div class="form-row">
            <div class="col">
              <input id="firstName" type="text" class="form-control" placeholder="First name" required>
            </div>
            <div class="col">
              <input id="lastName" type="text" class="form-control" placeholder="Last name" required>
            </div>
        </div>

        <div class="form-group">
            <label for="inputAge">Age <span>(optional)</span></label>
            <input type="number" class="form-control" id="age">
        </div>

        <div class="form-group">
            <label for="inputAge">Gender <span>(optional)</span></label>
            <input type="input" class="form-control" id="gender">
        </div>

        <div class="form-group">
            <label for="inputLang">Language Preference <span>(optional)</span></label>
            <input type="text" class="form-control" id="language">
        </div>

        <div class="form-group">
          <label for="email">Email address</label>
          <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
        </div>

        <div class="form-group">
          <label for="phoneNumber">Phone Number <span>(optional)</span></label>
          <input type="tel" id="phoneNumber" class="form-control" name="phone" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="555-555-5555">
        </div>

        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" class="form-control" id="address" placeholder="1234 Main St" required>
        </div>

        <div class="form-group">
            <label for="address2">Address 2 <span>(optional)</span></label>
            <input type="text" class="form-control" id="address2" placeholder="Apartment, studio, or floor">
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="city">City</label>
                <input type="text" class="form-control" id="city" required>
            </div>
            
            <div class="form-group col-md-4">
                <label for="state">State</label>
                <input type="text" class="form-control" id="state" required>
            </div>

            <div class="form-group col-md-2">
                <label for="zip">Zip</label>
                <input type="number" class="form-control" id="zip" required>
             </div>

        </div>

        <button id="submit" class="btn-primary btn">Submit</button>

    </form>
    <div id="confirmation" class="hide">
        <h1>Thank you for signing up!</h1>
        <p>Keep a lookout for updates in your email.</p>
        <p id="confirmName"></p>
        <p id="confirmEmail"></p>
        <p id="confirmNumber"></p>
        <p id="confirmAddress"></p>
        <p id="confirmGender"></p>
        <p id="confirmAge"></p>

        <button class="btn btn-primary" id="survey">Take Survey</button>
    </div>
</div>


{{!-- put jquery to collect form data here --}}
<script>
$("#submit").click(function(event){
    event.preventDefault()
    var formIsValid = $("#userForm")[0].checkValidity()
    
    if(formIsValid){
        populateUserData()
    console.log(true)
    }
})
function populateUserData(){
    var userData = {}
    $("input").each(function(){
        //console.log(element.val())
        //console.log($(this))
        var elementVal = $(this).val().trim()
        var elementID = $(this).attr("id")
        if(elementVal.length > 0){
            //if ID is equal to phone number, make sure to format the phone number
            userData[elementID] = elementVal
            $(this).val("")
        }
    })
    createNewUser(userData)
    //console.log(userData)
}
function createNewUser(userData){
    $.post("/api/user", userData, function(results){
        console.log(results)
        $("#confirmName").text(results.firstName + " " + results.lastName)
        $("#confirmEmail").text(results.email)
        if(results.address2 !== undefined){
            $("#confirmAddress").text(results.address + " " + results.address2 + " " + results.city + ", " + results.state + " " + results.zip)
        }else{
            $("#confirmAddress").text(results.address + " " + results.city + ", " + results.state + " " + results.zip)
        }
        if(results.phoneNumber !== undefined){
            $("#confirmNumber").text(results.phoneNumber)
        }
        if(results.gender !== undefined){
            $("#confirmGender").text(results.gender)
        }
        if(results.age !== undefined){
            $("#confirmAge").text(results.age)
        }
        if(results.languagePref !== undefined){
           $("#confirmLang").text(results.languagePref)
        }
        $("#survey").data("userID", results.uuid)
        $("#userForm").slideUp("slow")
        $("#confirmation").slideDown("slow")
    })
    $("#survey").click(function(){
        var userID = $(this).data("userID")
        window.location.href = "/survey/" + userID
    })
}
</script>