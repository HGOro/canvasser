{{!-- this is the user form --}}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

<div class="clipBoard">
    <div class="header1">
        <a href="" class="headerLink headPad marg1">Home</a>
        <a href="" class="headerLink headPad">User</a>
        <img src="./canvasser-large.png" alt="logo" class="headerLogo headPad">
        <a href="" class="headerLink headPad">Survey</a>
        <a href="" class="headerLink headPad marg2">Map</a>
    </div>
    <div class="jumbotron">
        <div class="row flag">
            <div class="col-3 bg-primary">
                <h1 class="display-4" id="stars">Welcome To Canvasser!</h1>
            </div>
            <div class="col-9" id="stripes">
                <div class="col-12 bg-danger" id="redStripe"></div>
                <div class="col-12 bg-light" id="whiteStripe"></div>
                <div class="col-12 bg-danger" id="redStripe"></div>
                <div class="col-12 bg-light" id="whiteStripe"></div>
                <div class="col-12 bg-danger" id="redStripe"></div>
                <div class="col-12 bg-light" id="whiteStripe"></div>
                <div class="col-12 bg-danger" id="redStripe"></div>
            </div>
        </div>
        <p class="lead col-12 bg-light" id="whiteStripe">Fill out a user profile here, then sumbit and fill out their
            survey!</p>
        <div class="col-12 bg-danger" id="redStripe"></div>
        <div class="col-12 bg-light" id="whiteStripe"></div>
        <div class="col-12 bg-danger" id="redStripe"></div>
        <p class="col-12 bg-light" id="whiteStripe">You can graph responses by different demographics once you have
            enough
            data.</p>
        <div class="col-12 bg-danger" id="redStripe"></div>
    </div>


    <div class="container">
        <form id="userForm">
            <div class="form-row">
                <div class="col">
                    <input id="firstName" type="text" class="form-control" placeholder="First name" required>
                </div>
                <div class="col">
                    <input id="lastName" type="text" class="form-control" placeholder="Last name" required>
                </div>
            </div>

            <div class="row">
                <div class="form-group col-4">
                    <label for="inputAge">Age</label>
                    <input type="number" class="form-control" id="age">
                </div>

                <div class="form-group col-4">
                    <label for="inputGend">Gender</label>
                    <div class="row">
                        <select id="gender">
                            <option> Male </option>
                            <option> Female </option>
                            <option> Non-binary </option>
                            <option> Prefer not to say </option>
                        </select>
                    </div>
                </div>

                <div class="form-group col-4">
                    <label for="inputLang">Language Preference </label>
                    <div class="row">
                        <select id="language">
                            <option value="english">English</option>
                            <option value="mandarin">Mandarin</option>
                            <option value="spanish">Spanish</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="email">Email address</label>
                <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
            </div>

            <div class="form-group">
                <label for="phoneNumber">Phone Number</label>
                <input type="tel" id="phoneNumber" class="form-control" name="phone"
                    pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="555-555-5555">
            </div>

            <div class="form-group">
                <label for="address">Address</label>
                <input type="text" class="form-control" id="address" placeholder="1234 Main St" required>
            </div>

            <div class="form-group">
                <label for="address2">Address 2 <span>(optional)</span></label>
                <input type="text" class="form-control" id="address2" placeholder="Apartment, studio, or floor">
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="city">City</label>
                    <input type="text" class="form-control" id="city" required>
                </div>

                <div class="form-group col-md-4">
                    <label for="state">State</label>
                    <input type="text" class="form-control" id="state" required>
                </div>

                <div class="form-group col-md-2">
                    <label for="zip">Zip</label>
                    <input type="number" class="form-control" id="zip" required>
                </div>

            </div>

            <button id="submit" class="btn-primary btn">Submit</button>

        </form>
        <div id="confirmation" class="hide">
            <h1>Thank you for signing up!</h1>
            <p>Keep a lookout for updates in your email.</p>
            <p id="confirmName"></p>
            <p id="confirmEmail"></p>
            <p id="confirmNumber"></p>
            <p id="confirmAddress"></p>
            <p id="confirmGender"></p>
            <p id="confirmAge"></p>

            <button class="btn btn-primary" id="survey">Answer Poll</button>
        </div>
    </div>
</div>

{{!-- put jquery to collect form data here --}}
<script>
    $("#submit").click(function (event) {
        event.preventDefault()
        var formIsValid = $("#userForm")[0].checkValidity()

        if (formIsValid) {
            populateUserData()
            console.log(true)
        }
        $("#survey").data("userID", results.userID)
        $("#userForm").slideUp("slow")
        $("#confirmation").slideDown("slow")
    })
    
    $("#survey").click(function(){
        var userID = $(this).data("userID")
        window.location.href = "/survey/" + userID
    })
    
function populateUserData() {
    var userData = {}
    $("input").each(function () {
        //console.log(element.val())
        //console.log($(this))
        var elementVal = $(this).val().trim()
        var elementID = $(this).attr("id")
        if (elementVal.length > 0) {
            //if ID is equal to phone number, make sure to format the phone number
            userData[elementID] = elementVal
            $(this).val("")
            }
        })
            createNewUser(userData)
            console.log(userData)
}

function createNewUser(userData) {
    $.post("/api/user", userData, function (results) {
        console.log(results)
        $("#confirmName").text(results.firstName + " " + results.lastName)
        $("#confirmEmail").text(results.email)
        if (results.address2 !== undefined) {
            $("#confirmAddress").text(results.address + " " + results.address2 + " " + results.city + ", " + results.state + " " + results.zip)
        } else {
            $("#confirmAddress").text(results.address + " " + results.city + ", " + results.state + " " + results.zip)
        }
        if (results.phoneNumber !== undefined) {
            $("#confirmNumber").text(results.phoneNumber)
        }
        if (results.gender !== undefined) {
            $("#confirmGender").text(results.gender)
        }
        if (results.age !== undefined) {
            $("#confirmAge").text(results.age)
        }
        if (results.languagePref !== undefined) {
            $("#confirmLang").text(results.languagePref)
        }
        $("#survey").data("userID", results.userID)
        $("#userForm").slideUp("slow")
        $("#confirmation").slideDown("slow")
    })
    
    $("#survey").click(function () {
        var userID = $(this).data("userID")
        window.location.href = "/survey/" + userID
    })
}
</script>